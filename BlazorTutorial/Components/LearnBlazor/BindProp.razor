@page "/learnBlazor/bindprop"
@using Models

<h3 class="mb-4">🧮 Product Management (Static CRUD Demo)</h3>

<!-- ✅ Add / Edit Form -->
<div class="card p-3 mb-4 shadow-sm">
    <h5>@(isEditMode ? "Edit Product" : "Add New Product")</h5>

    <div class="row mb-2">
        <div class="col-4">
            <input class="form-control" placeholder="Product Name" @bind="productModel.Name" />
        </div>
        <div class="col-3">
            <input class="form-control" placeholder="Price" type="number" @bind="productModel.Price" />
        </div>
        <div class="col-3">
            <input type="checkbox" class="form-check-input me-2" @bind="productModel.IsActive" />
            <label>Active</label>
        </div>
        <div class="col-2">
            @if (isEditMode)
            {
                <button class="btn btn-success" @onclick="UpdateProduct">Update</button>
                <button class="btn btn-secondary ms-2" @onclick="CancelEdit">Cancel</button>
            }
            else
            {
                <button class="btn btn-primary" @onclick="AddProduct">Add</button>
            }
        </div>
    </div>
</div>

<!-- ✅ Product Table -->
<table class="table table-bordered table-striped align-middle">
    <thead class="table-dark text-center">
        <tr>
            <th style="width: 10%">Id</th>
            <th style="width: 25%">Name</th>
            <th style="width: 20%">Price</th>
            <th style="width: 15%">Status</th>
            <th style="width: 30%">Action</th>
        </tr>
    </thead>

    <tbody>
        @foreach (var item in products)
        {
            <tr>
                <td class="text-center">@item.Id</td>
                <td class="text-center">@item.Name</td>
                <td class="text-center">@item.Price</td>
                <td class="text-center">
                    @if (item.IsActive)
                    {
                        <span class="badge bg-success">Active</span>
                    }
                    else
                    {
                        <span class="badge bg-secondary">Inactive</span>
                    }
                </td>
                <td class="text-center">
                    <button class="btn btn-warning btn-sm me-2" @onclick="() => EditProduct(item)">Edit</button>
                    <button class="btn btn-danger btn-sm" @onclick="() => DeleteProduct(item.Id)">Delete</button>
                </td>
            </tr>
        }
    </tbody>
</table>

@code {
    // ✅ Static Product List (simulates database)
    List<Product> products = new()
    {
        new() { Id = 1, Name = "Product 1", Price = 50,  IsActive = true },
        new() { Id = 2, Name = "Product 2", Price = 100, IsActive = true },
        new() { Id = 3, Name = "Product 3", Price = 200, IsActive = false }
    };

    Product productModel = new(); // used in form
    bool isEditMode = false;      // flag for edit mode
    int nextId = 4;               // keeps track of next ID

    // ➕ Add new product
    void AddProduct()
    {
        productModel.Id = nextId++;
        products.Add(productModel);
        productModel = new(); // reset form
    }

    // ✏️ Edit product
    void EditProduct(Product p)
    {
        productModel = new Product
        {
            Id = p.Id,
            Name = p.Name,
            Price = p.Price,
            IsActive = p.IsActive
        };
        isEditMode = true;
    }

    // ✅ Update product
    void UpdateProduct()
    {
        var existing = products.FirstOrDefault(x => x.Id == productModel.Id);
        if (existing != null)
        {
            existing.Name = productModel.Name;
            existing.Price = productModel.Price;
            existing.IsActive = productModel.IsActive;
        }
        isEditMode = false;
        productModel = new();
    }

    // ❌ Delete product
    void DeleteProduct(int id)
    {
        var item = products.FirstOrDefault(p => p.Id == id);
        if (item != null)
            products.Remove(item);
    }

    // ↩️ Cancel edit mode
    void CancelEdit()
    {
        isEditMode = false;
        productModel = new();
    }
}
